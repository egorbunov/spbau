%!TEX program = xelatex

\input{env.tex}
\title{Домашнее задание №11 \\ Алгоритмы. 5 курс. Весенний семестр.}
\author{Горбунов Егор Алексеевич}

\begin{document}
\maketitle
\begin{task}[1]
Разберитесь с пересчётом потенциалов при поиске потока. (Видимо, речь идёт об алгоритме поиска максимального потока минимальной стоимости с использованием потенциалов)
\end{task}
\begin{solution}
Пускай у нас есть сеть $(G, s, t)$ (со стоимостями $\omega(u, v)$ на рёбрах) и потенциальная функция $\varphi$ такая, что пересчитанные веса $\omega_{\varphi}(u,v) = \omega(u,v)+\varphi(u)-\varphi(v)$ неотрицательны. Пускай в этой сети мы нашли кратчайший путь из $s$ в $t$ и пустили по нему поток $f$. Тогда покажем, что:
\[
	\varphi_f(v) = \varphi(v) + dist_{\varphi}(s, v)
\]
есть потенциальная функция такая, что $\omega_{\varphi_f}(u, v) \geq 0$ для любого ребра из остаточной сети $G_f$, где $dist_{\varphi}$ --- это кратчайшее расстояние в сети $G$ исходя из весов $\omega_{\varphi}(u, v)$.

Посмотрим на рёбра в $G_f$. Их стоимости относительно потенциальной функции $\varphi_f$ равны:
\begin{align*}
	\omega_{\varphi_f}(u, v) &= \omega(u, v) + \varphi_f(u) - \varphi_f(v) = \omega(u,v)+\varphi(u)-\varphi(v) 
	+ dist_{\varphi}(s, u) - dist_{\varphi}(s, v) \\
	&= \omega_{\varphi}(u, v) + dist_{\varphi}(s, u) - dist_{\varphi}(s, v)
\end{align*}
\begin{itemize}
	\item Если $(u, v) \in G_f$ такое, что $(u, v) \in G$, то стоимость $\omega_{\varphi_f}(u, v)$ неотрицательна в силу того, что в $G$ с пересчитанными весами выполняется неравенство треугольника, т.е. $dist_{\varphi}(s, u) + \omega_{\varphi}(u, v) \geq dist_{\varphi}(s, v)$.
	\item Теперь пусть $(u, v) \in G_f$, но $(u, v) \notin G$. Это значит, что $(v, u) \in G$ по определению остаточной сети. Раз такое ребро $(u, v)$ оказалось в $G_f$, то по $(v, u)$ был пущен поток $f$, а значит $(v, u) \in G$ лежит на кратчайшем пути от $s$ к $t$ в $G$. Но это значит, что 
	\[
		\omega_{\varphi_f}(v, u) = \omega_{\varphi}(v, u) + dist_{\varphi}(s, v) - dist_{\varphi}(s, u) = 0
	\]
	Но стоимость обратного ребра $\omega_{\varphi_f}(u, v) = -\omega_{\varphi_f}(v, u) = 0$. А значит она неотрицательна. Всё. \xqed
\end{itemize}
\end{solution}

\newpage
\begin{task}[2]
Дан массив, найдите $k$ непересекающихся возрастающих последовательностей максимальной длины за $\bigO{kV^2}$.
\end{task}
\begin{solution}
Построим сеть $G$ с весами и пропускными способностями на рёбрах. Добавим в неё вершину $s$ и вершину $t$, а так же $V$ вершин $1, 2, \ldots, V$, соответствующих элементам массива. Соединим вершину $i$ с вершиной $j$ только в том случае, если $j > i$ и $a[j] > a[i]$ ($a$ --- это наш входной массив). На каждом таком ребре проставим пропускную способность равную $1$ и стоимость равную $-1$. Вершину $s$ соединим со всеми $V$ вершинами с пропускной способностью $1$ и стоимостью $-1$ и такими же рёбрами соединим все $V$ вершин с $t$.

Всё что нам теперь нужно сделать --- это найти $k$ максимальных вершинно-непересекающихся пути в построенном графе. Нам в этом поможет алгоритм поиска потока минимальной стоимости. Только перед применением нам нужно раздвоить все вершины в графе на ту, в которую рёбра входят и на ту, из которой они выходят и провести ребро --- это трюк для того, чтобы вершинно-непересекающиеся пути можно было искать как рёберно-непересекающиеся. Ставим на новых рёбрах пропускную способность $1$ и вес $-1$. 

Важно заметить, что в построенном графе не будет циклов, т.к. каждая вершина с индексом $i$ могла быть соединена только с вершинами с индексами $> i$ (для чистоты скажем, что у $s$ индекс $0$, а у $t$ $V + 1$).

Теперь для ответа на вопрос задачи требуется найти поток размера $k$ минимальный стоимости. В силу того, что веса на рёбрах отрицательны, то алгоритм поиска потока будет предпочитать более длинные пути, так как в них вмещается большее число отрицательных рёбер.

В качестве алгоритма для поиска такого потока будем использовать алгоритм с потенциалами, который прошли на упражнениях. \xqed
\end{solution}

\begin{task}[4]
Дан граф, на каждом ребре написано $2$ числа $L$ и $R$ и ещё дан вес $c$. По каждому ребру может течь не более чем $R$, но не менее, чем $L$ жидкости. Найдите:
	\begin{enumerate}
		\item произвольную циркуляцию
		\item произвольный поток
		\item максимальный поток
		\item поток минимальной стоимости
	\end{enumerate}
\end{task}
\begin{solution}
\begin{enumerate}
	\item Посмотрим на ребро исходного графа: $u \stackrel{L, R}{\longrightarrow} v$. Давайте добавим дополнительную вершину $t$ и раз из вершины $u$ по ребру $(u, v)$ должно выливаться $L$ жидкости, то спустим её в $t$, а по ребру $(u, v)$ разрешим пускать на $L$ меньше. Но теперь в вершину $v$ у нас приходит меньше, чем требовалось ровно на $L$, поэтому добавим фиктивную вершинку $s$ из которой в $v$ будет вливаться $L$ жидкости. Итого мы вместо каждого ребра $u \stackrel{L, R}{\longrightarrow} v$ добавляем три следующих:
	\[
		s \stackrel{0, L}{\longrightarrow} u,\ u \stackrel{0, R-L}{\longrightarrow} v,\ v \stackrel{0, L}{\longrightarrow} t
	\]
	Видно тогда, что если в полученном графе есть $s-t$ поток, который насыщает все рёбра из $s$, то в графе есть и циркуляция, которую из такого потока легко получить.
	\item Соединим сток и истоком ребром с ограничениями $L = 0, R = \infty$ и тогда, чтобы найти произвольный поток в исходном графе нужно найти произвольную циркуляцию в модифицированном.
	\item Бинарный поиск по левой границе $L$ добавляемого ребра (из пункта выше).
	\item Бинарный поиск по правой границе $R$ добавляемого ребра (из пункта выше).
\end{enumerate}
\end{solution}

\end{document}