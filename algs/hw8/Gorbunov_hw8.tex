\input{env.tex}
\title{Алгоритмы. Домашнее задание №8}
\author{Горбунов Егор Алексеевич}

\begin{document}
\maketitle

\task{Кубик и клетчатое поле}
\textit{Клеточное поле $n \times m$, кубик находится в северо западном (левом верхнем) углу в точке с координатами 
$(1,1)$. Положение кубика задано парой чисел $(1, 2)$, где $1$ --- это число, записанное на верхней грани, 
а $2$ --- на южной. На поле есть чёрные клетки --- на них кубик не может находиться. Нужно за $O(n,m)$ опредлить,
можно ли перекатить кубик в клетку $(n,m)$ так, чтобы он сохранил ориентацию, т.е. его положение равнялось бы $(1,2)$.}
\\
\textbf{Решение:} Заметим во первых то, что для однозначного ориентирования кубика на доске достаточно пары $(a,b)$, 
где $a$ --- число, записанное на верхней грани, а $b$ --- на южной грани. Т.е. по условию, если у кубика $1$ на верхней 
грани, а $2$ на южной, то $3$ на восточной, но тогда, т.к. сумма цифр на противоположных гранях равна $7$, все 
оставшиеся $3$ грани однозначно восстанавливаются.

Построим следующий граф $G(V,E)$: $\forall v \in V\ :\ v = (x,y,a,b)$, где $(x,y)$ --- координаты клетки на поле, а 
$a,b$ задают ориентацию кубика. Тогда $e=(v,u)\in E$, где $v = (x,y,a,b)$, а $u=(x',y',a',b')$, тогда и только тогда,
когда кубик, ориентация которого задана $(a,b)$ и стоящий в клетке $(x,y)$ можно перекатить в клетку $(x',y')$ так, что
его ориентация станет $(a',b')$, причём $(x',y')$ --- сосед $(x,y)$.

Очевидно, что в таком графе $G$ у каждой вершины будет не более $4$ инцидентных ей рёбер (рёбер может быть не ровно 4 т.к.
некоторые клетки чёрные и в них нельзя перекатываться). Всего вершин в графе $G$: число позиций на доске поможить на число
возможных ориентаций кубика, а это равно $6\cdot 4nm = 24nm$. Таким образом в $G$ $\bigO{nm}$ рёбер.

Мы решим задачу, если ответим на вопрос: есть ли путь в графе $G$ из $(1,1,1,2)$ в $(n,m,1,2)$. На этот вопрос можно ответить
запустив $BFS$ на графе $G$. В силу того, что в $G$ $\bigO{nm}$ рёбер, алгоритм отработает за $\bigO{nm}$. \xqed

\task{Потоп}
\textit{Найти минимальное время, чтобы перебраться из клетки $(1,1)$ в клетку $(n,m)$ по клеткам, в каждой из
которых каждую минуту прибывает вода. Переход из клетки в клетку занимает минуту. В каждой клетке указана её высота.}
\textbf{Решение:} видно, что если в момент времени $t$ мы находимся в клетке $(x,y)$, то из неё можно добраться в какую-то
из соседних клеток $(x',y')$, если $h(x',y') > t+1$, где $h(x',y')$ --- высота клетки $(x',y')$. Таким образом построим
следующих граф $G(V,E)$, где каждая вершина описывает некоторую клетку в некоторый момент времени: $v = (x,y,t)$. Тогда
ребро в этом графе между вершинами $(x,y,t)$ и $(x',y',t')$ будет существовать только тогда, когда $(x',y')$ --- сосед 
$(x,y)$, $t < h(x,y)$, $t' = t + 1 < h(x',y')$. Ясно, что в таком графе, если мы найдём путь между вершиной $(1,1,0)$
и вершиной $(n,m,t)$ такой, что $t$ --- минимально. Т.е. нужно просто проверить достижимость из $(1,1,0)$ всех вершин 
$(n,m,t)$, где $t \in [0,h(n,m))$ и ответом будет минимальное $t$, что $(n,m,t)$ достижима из $(1,1,0)$. 
Это можно проделать при помощи $BFS$ по графу $G$. В графе $G$ $nmh_{max}$ вершин и $\bigO{nmh_{max}}$ рёбер (т.к. каждая
вершина может быть соединена с не более чем $4$ (4 соседних клетки) другими вершинами), так что
алгоритм работает за $\bigO{nmh_{max}}$. \xqed

\task{Ограф с платными рёбрами}
\textit{Дан орграф $G$. Есть $K$ типов платных рёбер. Чтобы двигаться по платному ребру типа $x$ нужно иметь пропуск 
этого типа. Пропуск можно носить лишь один. В каждой вершине пропуск любого типа можно купить за $A$ и продать за $B$
($0<B<A$).
Найти самый дешёвый способ дойти из $s$ в $t$ за $\bigO{K(V+E)}$}
\textbf{Решение:} Заметим, что нам интересно минимизировать число покупок/обменов пропуска. Если мы будем знать число 
обменов пропуска, то стоимость пути легко посчитаем в силу того, что любой обмен стоит $A-B$. Давайте купим в вершине
$s$ пропуск. А в вершине $t$ его продадим. Это может быть лишней тратой денег (лишний обмен), если какая-то начальная часть пути идёт по бесплатным рёбрам, но мы можем это отследить при применении алгоритма и исправить итоговую стоимость. Окей.

Таким образом у нас есть какой-то пропуск и мы начинаем путь. Сделаем так, чтобы обмен пропуска представлял из себя проход
по какому-нибудь ребру. Для начала расставим на всех рёбрах графа вес равный $0$.Пусть $v \in V_G$ и в $G$ входят и 
выходят рёбра типов $k_1,k_2,\ldots,k_i$ и ещё возможно бесплатные рёбра. Тогда превратим вершину $v$ в полный граф 
на $i+1$ вершне и расставим веса на рёбрах этого полного подграфа так:
$1$ поставим там, где осуществляется переход между вершинами, соответствующими каким-то типам платных рёбер или из 
бесплатного в платное. А $0$ поставим на рёбрах из вершины, соответствующей платному классу и ведущих в вершину, соотв.
бесплатному классу. Так сделаем с каждой вершиной исходного графа. Таким образом мы получим граф $G$, в котором теперь
не более $|V|(K+1)$ вершин и не более $|E|(K)$ рёбер (т.к. каждая вершина стала полным графом на $K+1$ вершине). Причём
этот граф --- это $0-1$ граф. А для него мы умеем $BFS$-ом искать кратчайший путь. Заметим, что этот путь как раз будет
характеризовать путь с наименьшим числом обменов в исходном графе. Итого получили алогритм с асимптотикой: $\bigO{K(|V|+|E|)}$
\xqed
\end{document}