\input{env.tex}
\title{Алгоритмы. Домашнее задание №10}
\author{Горбунов Егор Алексеевич}

\begin{document}
\maketitle

\task{Второе минимальное остовное дерево}
\textbf{Задача:} по данному графу $G$ (с заданной весовой функцией $\omega$ на рёбрах) и минимальному остовному 
дереву $T_1$ найти второе минимальное остовное дерево $T_2$ за $\bigO{V^2 + E}$\\
\textbf{Решение:}\\
\textit{Лемма 1}. Возьмём любое $e \in E(G)-E(T_1)$. Тогда в графе $H = T_1 \cup e$ есть единственный простой цикл $C$ 
содержащий $e$, причём вес ребра $e$ больше или равен веса любого другого ребра из цикла $C$.\\
\textit{Доказательство:} Ясно, что т.к. $T_1$ --- дерево на $n = |V(G)|$ вершинах, то от добавления ребра $e$, $T_1$ 
перестанет быть деревом, т.е. в полученном графе $H$ будет единственный цикл $C$, содержащих ребро $e$. 
Пускай теперь в $C$ есть ребро $e'$, вес которого больше веса $e$. Тогда, т.к. цикл $C$ --- единственный в $H$, то удалив
ребро $e'$ мы получим некоторое остовное дерево $T'$ вес которого будет таковым: $\omega(T') = \omega(T_1)+\omega(e)-\omega(e') < \omega(T_1)$,
но это значит, что $T_1$ --- не минимальное остовное дерево. Противоречие и лемма доказана. \xqed\\
\textit{Утверждение 1.} \underline{$T_1$ отличается от $T_2$ лишь одним ребром.}\\
Действительно. Пускай $T_1$ отличается от $T_2$ в $k\geq 2$ рёбрах. Заметим вот что: добавим рёбра из $T_2-T_1$ к $T_1$
и получим граф $H$ с $k$ циклами, которые можно убрать, удалив их графа $H$ рёбра из $T_1-T_2$ (это верно т.к. $T_2$ --- дерево).
Т.е. в каждом из этих $k$ циклов $C_i$ графа $H$ есть ребро $x_i$ из $T_2-T_1$ и ребро $y_i$ из $T_1-T_2$. Для первых $k-1$
цикла $C_i$ удалим из $H$ Ребро $x_i$ и лишь для $k$-го цикла $C_k$ удалим из $H$ $y_k$.
Таким образом мы получим некоторое остовное дерево $T'$, т.к. все $k$ циклов были разорваны.
По Лемме 1 для всех $C_i$ $\omega(x_i) \geq \omega(y_i)$, а значит, т.к. $x_i \in T_2$, то вес полученного $T'$ уж точно
не больше веса $T_2$, но $T'$ отличается от $T_1$ лишь одним ребром! Если $\omega(T')=\omega(T_2)$, то мы нашли второй 
остов, который отличается от $T_1$ одним ребром, т.к. $T_2$ --- второй остов, а если $\omega(T')<\omega(T_2)$, то мы пришли 
к противоречию и значит, опять же, что второй минимальный остов отличается от $T_1$ лишь одним ребром. \xqed\\
\textit{Утверждение 2.} \underline{$\omega(T_2) = \omega(T_1) + min_{e\in E(G)}(\omega(e) - m[e_u,e_v])$}, где $e = (e_u,e_v)$, 
а $m[e_u,e_v]$ --- это максимальный вес ребра на пути из $e_u$ в $e_v$ в минимальном остове $T_1$.\\
Действительно. По утверждению 1 мы знаем, что $T_2$ отличен от $T_1$ лишь одним ребром. Пусть это ребро $e = (e_v, e_u)$. Добавив его
в $T_1$ мы получаем граф $H$ с циклом, из которого нужно удалить некоторое ребро $e' \in E(T_1)$, чтобы получить $T_2$. Ясно, что
ребро $e'$ лежит на пути из $e_v$ в $e_u$ дерева $T_1$. Ясно, что $\omega(T_2)=\omega(T_1)+(\omega(e)-\omega(e'))$. Причём
$\omega(T_2)$ минимальное такое, что $\omega(T_2) \geq \omega(T_1)$. Но это значит, что формулу для веса $T_2$ можно переписать
так:
\[ \omega(T_2) = \omega(T_1) + min_{e,e'}(\omega(e)-\omega(e'))\]
Но ребро $e'$ лежит в $T_1$ на пути от $e_v$ к $e_u$ и нам, очевидно, т.к. перед $\omega(e')$ выше стоит знак минуса,
хотелось бы максимизировать это значение, т.е. формулу можно переписать так:
\[ \omega(T_2) = \omega(T_1) + min_{e}(\omega(e)-m[e_v,e_u])\]
Это мы и хотели доказать! \xqed\\
\textit{Алгоритм.} Теперь можно приступать к алгоритму. Нам дан граф $G$ и минимальное остовное дерево $T_1$.
В силу утверждения $2$ стало ясно, что для того, чтобы получить $T_2$ нам нужно в множестве $E(G)$ найти такое ребро 
$e = (u, v)$, что число $\omega(e)~-~m[e_v,e_u]$ минимально. Нужная асимптотика --- $\bigO{V^2 + E}$, т.е. два вложенных
цикла по рёбрам нам не позволительны, а значит нужно как-то предподсчитать $m[e_v,e_u]$ для всех пар вершин из $V(G)$.
Но это уже очевидная задача: найдём все $m[v,u]$ для закреплённого $v$: устроим поиск в глубину из $v$ в $T_1$. Тогда,
если мы посчитали $m[v,u]$, то легко можно посчитать $m[v,c_u] = max(\omega(u,c_u),m[v,u])$, 
где $c_u$ --- ребёнок $u$ в дереве обхода в глубину графа $T_1$. Для каждой закреплённой корневой вершины это будет работать
за $\bigO{|V(T_1)|+|E(T_1)|} = \bigO{V}$. Тогда всю матрицу $m[v,u]$ мы посчитаем за $\bigO{V^2}$. Вот и всё. Таким образом 
мы за $\bigO{V^2}$ посчитали $m[v,u]$ для всех $v,u\in V(G)$. А теперь легко за $\bigO{E}$ найдём такое ребро $e$, что
$\omega(e)~-~m[e_v,e_u]$ минимально. Итого мы получили корректный алгоритм со временем работы $\bigO{V^2+E}$ \xqed


\task{Дерево Штайнера}



\end{document}